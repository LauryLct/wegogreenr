<div class="messages">
 <% @activity.messages.each do |message| %>
   <div class="message <%= current_user && current_user.id = message.user.id ? "owner" : '' %>">
    <div class="message-infos">
      <p class="message-infos-author"><%= message.user.profile.first_name %></p>
    </div>
    <div class="message-body">
      <%= message.content %>
    </div>
   </div>
 <% end %>
</div>

<% content_for :after_js do %>
 <script>
 function scrollLastMessageIntoView() {
   const messages = document.querySelectorAll('.message');
   const lastMessage = messages[messages.length - 1];
   lastMessage.scrollIntoView();
 }
 console.log('should be here')
 App['activity_<%= @activity.id %>'] = App.cable.subscriptions.create({ channel: 'ActivityChannel',
 activity_id: <%= @activity.id %> },
   { received: (data) => {
     if (data.type === 'message') {
     var messagesContainer = document.querySelector(".messages");
     var user_present = <%= current_user ? true : false %>
     messagesContainer.insertAdjacentHTML('beforeend',
      `
       <div class=“message owner”>
          <div class=“message-infos”>
            <p class=“message-infos-author”>${data.data.sender}</p>
            <p class=“message-infos-sent”>${new Date(data.data.message.created_at).toLocaleTimeString()}</p>
          </div>
          <div class=“message-body”>
            ${data.data.message.content}
          </div>
        </div>
       `
     );
     scrollLastMessageIntoView();
     }
   }
   })
 </script>
<% end %>
